// new module script
int bonePileCount;
bool isDogWithBonne(){
  return cDog.View == DOGIDDLE2 || cDog.View == DOGWALK2 ; 
}

void dogLooseBone(){
  if(isDogWithBonne()){
    cDog.ChangeView(DOGWALK1);
    cDog.SetIdleView(DOGIDDLE1, 1);
    KeyboardMovement.SetIdleView(DOGIDDLE1, 1);   
  }
}

void updateBonePileGraphic(){
  if(bonePileCount == 0){
    cBonePile.ChangeView(BONEPILE0);
  } else if(bonePileCount == 1){
    cBonePile.ChangeView(BONEPILE1);
  } else if(bonePileCount == 2){
    cBonePile.ChangeView(BONEPILE2);
  } else if(bonePileCount == 3){
    cBonePile.ChangeView(BONEPILE3);
  } 
}

void resetBonePile(){
  bonePileCount = 0;
  updateBonePileGraphic();
} 

int incrementBonePile(){
  bonePileCount++;
  updateBonePileGraphic();
}

void dogHitBonePile(){
  if(isDogWithBonne()){
    dogLooseBone();
    incrementBonePile();
  }
}


void splashArmsLegs(Character * enemy){
  int ox = enemy.x-30;
  int oy = enemy.y-70;
  float timeTw = 0.6;
  
  gLegs1.X = ox;
  gLegs2.X = ox;
  gArms1.X = ox;
  gArms2.X = ox;
  gLegs1.Y = oy;
  gLegs2.Y = oy;
  gArms1.Y = oy;
  gArms2.Y = oy;
  
  //gLegs1.Animate(ENEMY1LEGS, 
  
  gLegs1.Visible = true;
  gLegs2.Visible = true;
  gArms1.Visible = true;
  gArms2.Visible = true;
  
  gLegs1.TweenPosition(timeTw, Room.Width + Random(100), Room.Height + Random(100), eEaseInSineTween, eNoBlockTween);
  gLegs2.TweenPosition(timeTw, 0 -20 - Random(100), Room.Height + Random(100), eEaseInSineTween, eNoBlockTween);
  gArms1.TweenPosition(timeTw, Room.Width + Random(100), Room.Height + Random(100), eEaseInSineTween, eNoBlockTween);
  gArms2.TweenPosition(timeTw, -20- Random(100), Room.Height + Random(100), eEaseInSineTween, eNoBlockTween);
}


void HitEnemy(Character * enemy){
  if(cDog.NormalView == DOGWALK2){
    return;  
  }
  
  int chomp_delay = 2;
  int x_off = 18 ;
  int y_off =47 ;
  enemy.LockView(ENEMY1HIT, eStopMoving);  
  
  gBlood.SetPosition(cDog.x - x_off, cDog.y - y_off);
  
  gBlood.Visible = true;
  gBlood.BackgroundGraphic = 66;
  gBlood.LockView(VIEWBLOOD);
  gBlood.Animate(0, 1, eOnce, eNoBlock, eForwards);
  
  gFakeOverlay.BackgroundGraphic = 1;
  gFakeOverlay.SetPosition(cDog.x - x_off, cDog.y - y_off);
  gFakeOverlay.Visible = true;
  Wait(chomp_delay);
  
  gFakeOverlay.BackgroundGraphic = 2;
  gFakeOverlay.SetPosition(cDog.x - x_off, cDog.y - y_off);
  Wait(chomp_delay);  

  gFakeOverlay.BackgroundGraphic = 3;
  gFakeOverlay.SetPosition(cDog.x - x_off, cDog.y - y_off);
  Wait(chomp_delay);
  
  gFakeOverlay.BackgroundGraphic = 4;
  gFakeOverlay.SetPosition(cDog.x - x_off, cDog.y - y_off);
  Wait(chomp_delay);
  
  gBlood.Visible = false;
  gFakeOverlay.Visible = false;
  
  splashArmsLegs(enemy);
  //enemy.UnlockView();
  cDog.ChangeView(DOGWALK2);
  cDog.SetIdleView(DOGIDDLE2, 1);
  KeyboardMovement.SetIdleView(DOGIDDLE2, 1);
  
  enemy.ChangeRoom(TRASH);  
}

void dealWithEnemy1(Character * enemy1){
   if(enemy1.DestinationX == 16 && enemy1.Moving){
    
  } else if(enemy1.DestinationX == Room.Width - 16 && enemy1.Moving){
    
  } else if(enemy1.x == 16 && enemy1.View != ENEMY1HIT){
    enemy1.AddWaypoint(Room.Width - 16 , enemy1.y);
  } else if( enemy1.View != ENEMY1HIT) {
    enemy1.AddWaypoint(16 , enemy1.y);    
  }
  
  if(enemy1.IsCollidingWithChar(cDog)){
    HitEnemy(enemy1);
  }
}

void checkBonePileRepExe(){
  if(cBonePile.IsCollidingWithChar(cDog)){
    dogHitBonePile();
  } 
}


void init_enemy1(Character * enemy1){
  enemy1.AddWaypoint(16, enemy1.y);  
}

